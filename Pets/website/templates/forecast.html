{% extends 'base.html' %}
{% load static %}


{% block content %}


<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


<h1>7-Day Forecast for {{ city }}</h1>


<div class="forecast-container">
    {% for day in forecast %}
    <div class="day-card">
        <h3>{{ day.day_time }}</h3>
        <p>{{ day.date }}</p>


        <img src="http://openweathermap.org/img/wn/{{ day.icon }}@2x.png" alt="weather icon">
        <p>{{ day.temp }}°C</p>
        <p style="text-transform: capitalize;">{{ day.description }}</p>
    </div>
    {% endfor %}
</div>


<h2>Humidity Over the Week</h2>


<div class="chart-container">
    <canvas id="humidityChart"></canvas>
</div>


<div style="display: flex; justify-content: center; gap: 20px; margin-top: 20px;">
    {% for day in forecast %}
        <div style="text-align: center;">
            <img src="http://openweathermap.org/img/wn/{{ day.icon }}.png">
            <p style="font-size: 0.8rem;">{{ day.description }}</p>
        </div>
    {% endfor %}
</div>


<style>
    h1, h2 {
        text-align: center;
        margin-top: 30px;
    }


    .forecast-container {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        justify-content: center;
        margin-top: 20px;
    }


    .day-card {
        border: 1px solid #ccc;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
        width: 160px;
        background: rgba(255, 255, 255, 0.9);
    }


    .chart-container {
        max-width: 700px;
        margin: 40px auto;
    }
</style>


<script>
    const labels = [
        {% for day in forecast %}
            "{{ day.day_time }}",
        {% endfor %}
    ];


    const humidityData = [
        {% for day in forecast %}
            {{ day.humidity }},
        {% endfor %}
    ];


    const temperatureData = [
        {% for day in forecast %}
            {{ day.temp }},
        {% endfor %}
    ];


    const conditions = [
        {% for day in forecast %}
            "{{ day.description }}",
        {% endfor %}
    ];


    const ctx = document.getElementById('humidityChart').getContext('2d');


    new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                {
                    label: 'Humidity (%)',
                    data: humidityData,
                    yAxisID: 'yHumidity',
                    tension: 0.4,
                    fill: true
                },
                {
                    label: 'Temperature (°C)',
                    data: temperatureData,
                    yAxisID: 'yTemp',
                    tension: 0.4,
                    fill: false
                }
            ]
        },
        options: {
            responsive: true,
            plugins: {
                tooltip: {
                    callbacks: {
                        afterLabel: function(context) {
                            return "Condition: " + conditions[context.dataIndex];
                        }
                    }
                }
            },
            scales: {
                yHumidity: {
                    type: 'linear',
                    position: 'left',
                    beginAtZero: true,
                    max: 100,
                    title: {
                        display: true,
                        text: 'Humidity (%)'
                    }
                },
                yTemp: {
                    type: 'linear',
                    position: 'right',
                    title: {
                        display: true,
                        text: 'Temperature (°C)'
                    },
                    grid: {
                        drawOnChartArea: false
                    }
                }
            }
        }
    });
</script>


{% endblock %}
